name: Python CI

on:
  push:
    branches:
      - dev

jobs:
  build:
    runs-on: ubuntu-20.04

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: SSH into GCP instance
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.DEV_GCP_INSTANCE_IP }}
        username: james
        key: ${{ secrets.DEV_SSH_PRIVATE_KEY }}
        script: |
          sudo docker exec -it veriscope-internal-laravel.test-1 bash
          cd tests
          pytest

    # - name: Set up Python
    #   uses: actions/setup-python@v2
    #   with:
    #     python-version: 3.x

    # - name: Install system dependencies
    #   run: sudo apt update && sudo apt install -y python-pytest

    # - name: Install dependencies
      # no need to used requirement so remark
      # run: pip install -r requirements.txt
      # run: sudo pip install -U requests && sudo pip install -U pytest pytest-html

    # No need to run in jenkins
    # - name: Run tests
    #   run: pytest

    # No need to commit again, so remart this part
    # - name: Commit changes
    #   run: git commit -am "Passed tests"

    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        # repository: <target-repository>  # 目标仓库的所有者和名称，例如 ad-m/my-repo
        branch: dev  # 要推送到的目标分支
        # directory: <path-to-directory>  # 要推送的目录路径
        github_token: ${{ secrets.MY_TOKEN }}